(()=>{"use strict";class t{static frequencyLookup={c:261.63,"c#":277.18,d:293.66,"d#":311.13,e:329.63,f:349.23,"f#":369.99,g:392,"g#":415.3,a:440,"a#":466.16,b:493.88};constructor(e,a){this.note=e,this.octave=a;const s=t.frequencyLookup[e.toLowerCase()];if(!s)throw new Error(`that note (${e}) does not exist, only sharps are accepted`);this.frequency=s*Math.pow(2,a)}static NoteFromFequency(){Object.values(t.frequencyLookup).filter()}}class e{constructor(t,e){if(this.steps=t,this.startingNote=e,!e.note||!e.frequency||!e.octave)throw new Error("Make sure to pass a note object to the scale constructor")}getNoteAtScaleStep(e){const a=Math.floor(e/this.steps.length)+this.startingNote.octave,s=this.steps[e%this.steps.length],i=(Object.keys(t.frequencyLookup).indexOf(this.startingNote.note)+s)%12,[o]=Object.entries(t.frequencyLookup)[i];if(!o)throw new Error(`could not get note ${this.startingNote} in ${Object.keys(t.frequencyLookup)}`);return new t(o,a)}}const a=[10,90],s=[0,16],i=[0,12],o=(t,[e,a])=>t<e?e:t>a?a:t;class r{constructor({stemHeight:t,petalCurve:e,petalWidth:a,petalHeight:s,petalColor:i,petalCount:o,headScalePattern:r,scale:n,petalOffset:h}){this.stemHeight=t,this.petalCurve=e,this.petalWidth=a,this.petalHeight=s,this.petalColor=i,this.petalCount=o,this.petalOffset=h,this.headScalePattern=r,this.scale=n}static getSerialization(){}static MergeFlowerData(t,e){}static RandomFlowerData(){return new r({stemHeight:o(Math.floor(Math.random()*i[1]),i),petalCurve:1*Math.random(),petalWidth:o(Math.random()*a[1]+20,a),petalHeight:200*Math.random()+100,petalColor:[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],petalCount:[2,4,8,16][Math.floor(4*Math.random())],headScalePattern:[0],scale:(n=new t("f",-1),new e([0,4,7],n)),petalOffset:o(17*Math.random(),s)});var n}}class n{constructor(t,e,a){this.state=a,this.data=e,this.ctx=t}draw(){const t=window.innerHeight-(30*this.data.stemHeight+100);this.ctx.translate(this.state.position,t),this.drawStem(10,t),this.drawHead(),this.drawPetals(),this.ctx.translate(-1*this.state.position,-1*t)}drawStem(t,e){this.ctx.fillStyle="#73ba8d",this.ctx.fillRect(-.5*t,0,t,flowerCanvas.height-e)}drawPetals(){var t=Math.PI/180;const e=t*(360/s[1]*this.data.petalOffset);this.ctx.rotate(e);for(var a=0;a<this.data.petalCount;a++){const e=a==this.state.currentStep&&this.state.isPlaying,s=this.data.petalColor,i=`#${s[0].toString(16)}${s[1].toString(16)}${s[2].toString(16)}`,o=e?i:i+"88";this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.quadraticCurveTo(this.data.petalCurve*this.data.petalHeight,this.data.petalWidth,this.data.petalHeight,0),this.ctx.moveTo(0,0),this.ctx.quadraticCurveTo(this.data.petalCurve*this.data.petalHeight,-1*this.data.petalWidth,this.data.petalHeight,0),this.ctx.fill(),this.ctx.rotate(t*(360/this.data.petalCount))}this.ctx.rotate(t*(360-360/this.data.petalCount*a)),this.ctx.rotate(-1*e)}drawHead(){this.ctx.fillStyle="#fced7e",this.ctx.beginPath(),this.ctx.arc(0,0,15,0,2*Math.PI),this.ctx.fill()}}class h{constructor({currentStep:t,position:e}){this.currentStep=t||0,this.receivedBeats=0,this.position=e||0,this.isPlaying=!1}reset(){this.currentStep=0,this.receivedBeats=0}}class l{constructor(t,e,a){this.state=a,this.data=e,this.audioCtx=t,this.amount=Math.random()<.5?.5:1}destroy(){this.stopCurrentNote()}playCurrentNote(){const t=this.data.scale.getNoteAtScaleStep(this.data.stemHeight);if(!this.state.isPlaying&&Math.random()<this.amount){this.oscillator=new OscillatorNode(this.audioCtx,{type:"sawtooth",frequency:t.frequency}),this.filter=new BiquadFilterNode(this.audioCtx,{frequency:200,Q:1});const e=this.data.petalCount<16?Math.floor(this.data.petalWidth/10):Math.floor(4*Math.random());this.filter.frequency.setTargetAtTime(1e3,this.audioCtx.currentTime,e),this.oscillator.connect(this.filter).connect(this.audioCtx.destination),this.oscillator.start(),this.state.isPlaying=!0}}stopCurrentNote(){this.state.isPlaying&&(this.oscillator.stop(),this.oscillator.disconnect(),this.oscillator=null,this.state.isPlaying=!1)}}class c{constructor(t,e){this.state=new h({position:500+400*Math.random()-400*Math.random()}),this.data=r.RandomFlowerData(),this.visualizer=new n(t,this.data,this.state),this.audio=new l(e,this.data,this.state)}beatUpdate(){const t=Math.floor(64/this.data.petalCount);0===this.state.receivedBeats&&this.audio.playCurrentNote(),this.state.receivedBeats===Math.floor(64/this.data.petalCount)-2&&this.audio.stopCurrentNote(),this.state.receivedBeats+=1,this.state.receivedBeats===t&&(this.state.receivedBeats=0,this.state.currentStep=(this.state.currentStep+1)%this.data.petalCount)}destroy(){this.audio.destroy()}}let d,u,f={},p=!1;function w(t=!0){const e=new c(d,u),a=e.data.stemHeight%6;if(f[a]){if(f[a].length>=1){if(!t)return void console.warn("flower not added too many similiar notes");f[a].splice(0,1)}f[a].push(e),console.log(f)}else f[a]=[e]}function g(){return Object.values(f).reduce(((t,e)=>[...t,...e]),[])}window.onload=function(){window.onclick=()=>{if(console.log("clicked"),p){g().forEach((t=>{t.destroy()})),f={};const t=Math.floor(5*Math.random())+1;for(let e=0;e<=t;e++)w(!0)}else!function(){const t=window.AudioContext||window.webkitAudioContext;u=new t;const e=document.getElementById("flowerCanvas");if(!e)throw new Error("could not find flower Canvas");if(d=e.getContext("2d"),!e)throw new Error("could not get context");w(),v(),window.onresize=function(t){v()};window.setInterval((()=>{C++,32==C&&(C=0),g().forEach((t=>{t.beatUpdate()}))}),31.25),window.setInterval((()=>{}),16),window.setInterval((()=>{m(d)}),16),m(d)}(),p=!0}};let C=0;function m(t){!function(t){t.fillStyle="#d8ddeb",t.fillRect(0,0,flowerCanvas.width,flowerCanvas.height)}(t),g().forEach((t=>{t.visualizer.draw()}))}function v(){const t=document.getElementById("flowerCanvas"),e=window.innerHeight,a=window.innerWidth;t.setAttribute("width",a),t.setAttribute("height",e)}})();