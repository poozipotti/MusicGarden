(()=>{"use strict";class t{static frequencyLookup={c:261.63,"c#":277.18,d:293.66,"d#":311.13,e:329.63,f:349.23,"f#":369.99,g:392,"g#":415.3,a:440,"a#":466.16,b:493.88};constructor(e,a){this.note=e,this.octave=a;const s=t.frequencyLookup[e.toLowerCase()];if(!s)throw new Error(`that note (${e}) does not exist, only sharps are accepted`);this.frequency=s*Math.pow(2,a)}static NoteFromFequency(){Object.values(t.frequencyLookup).filter()}}class e{constructor(t,e){if(this.steps=t,this.startingNote=e,!e.note||!e.frequency||!e.octave)throw new Error("Make sure to pass a note object to the scale constructor")}getNoteAtScaleStep(e){const a=Math.floor(e/this.steps.length)+this.startingNote.octave,s=this.steps[e%this.steps.length],i=(Object.keys(t.frequencyLookup).indexOf(this.startingNote.note)+s)%12,[o]=Object.entries(t.frequencyLookup)[i];if(!o)throw new Error(`could not get note ${this.startingNote} in ${Object.keys(t.frequencyLookup)}`);return console.log(o,a),new t(o,a)}}const a=[20,120],s=(t,[e,a])=>t<e?e:t>a?a:t;class i{constructor({stemHeight:t,petalCurve:e,petalWidth:a,petalHeight:s,petalColor:i,petalCount:o,headScalePattern:r,scale:n}){this.stemHeight=t,this.petalCurve=e,this.petalWidth=a,this.petalHeight=s,this.petalColor=i,this.petalCount=o,this.headScalePattern=r,this.scale=n}static getSerialization(){}static MergeFlowerData(t,e){}static RandomFlowerData(){return new i({stemHeight:Math.floor(24*Math.random()),petalCurve:1*Math.random(),petalWidth:s(200*Math.random(),a),petalHeight:200*Math.random()+100,petalColor:[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],petalCount:[2,4,8,16][Math.floor(4*Math.random())],headScalePattern:[0],scale:(o=new t("c",-2),new e([0,2,4,5,7,9,11],o))});var o}}class o{constructor(t,e,a){this.state=a,this.data=e,this.ctx=t}draw(){const t=window.innerHeight-15*this.data.stemHeight;this.ctx.translate(this.state.position,t),this.drawStem(20,t),this.drawPetals(),this.drawHead(),this.ctx.translate(-1*this.state.position,-1*t)}drawStem(t,e){this.ctx.fillStyle="#73ba8d",this.ctx.fillRect(-.5*t,0,.5*t,flowerCanvas.height-e)}drawPetals(){for(var t=Math.PI/180,e=0;e<this.data.petalCount;e++){const a=e==this.state.currentStep,s=this.data.petalColor,i=`#${s[0].toString(16)}${s[1].toString(16)}${s[2].toString(16)}`,o=a?i:i+"88";this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.quadraticCurveTo(this.data.petalCurve*this.data.petalHeight,this.data.petalWidth,this.data.petalHeight,0),this.ctx.moveTo(0,0),this.ctx.quadraticCurveTo(this.data.petalCurve*this.data.petalHeight,-1*this.data.petalWidth,this.data.petalHeight,0),this.ctx.fill(),this.ctx.rotate(t*(360/this.data.petalCount))}this.ctx.rotate(t*(360-360/this.data.petalCount*e))}drawHead(){this.ctx.fillStyle="#fced7e",this.ctx.beginPath(),this.ctx.arc(0,0,15,0,2*Math.PI),this.ctx.fill()}}class r{constructor({currentStep:t,position:e}){this.currentStep=t||0,this.receivedBeats=0,this.position=e||0,this.isPlaying=!1}reset(){this.currentStep=0,this.receivedBeats=0}}class n{constructor(t,e,a){this.state=a,this.data=e,this.audioCtx=t,this.filter=new BiquadFilterNode(this.audioCtx,{frequency:800,q:300})}destroy(){this.stopCurrentNote()}playCurrentNote(){const t=this.data.scale.getNoteAtScaleStep(this.data.stemHeight);this.state.isPlaying||(this.oscillator=new OscillatorNode(this.audioCtx,{type:"sawtooth",frequency:t.frequency}),this.oscillator.connect(this.filter).connect(this.audioCtx.destination),this.oscillator.start(),this.state.isPlaying=!0)}stopCurrentNote(){this.state.isPlaying&&(this.oscillator.stop(),this.oscillator.disconnect(),this.oscillator=null,this.state.isPlaying=!1)}}class h{constructor(t,e){this.state=new r({position:500}),this.data=i.RandomFlowerData(),this.visualizer=new o(t,this.data,this.state),this.audio=new n(e,this.data,this.state)}beatUpdate(){0===this.state.receivedBeats&&this.audio.playCurrentNote(),this.state.receivedBeats===Math.floor(64/this.data.petalCount)-2&&this.audio.stopCurrentNote(),this.state.receivedBeats+=1,this.state.receivedBeats===Math.floor(64/this.data.petalCount)&&(this.state.receivedBeats=0,this.state.currentStep=(this.state.currentStep+1)%this.data.petalCount)}destroy(){this.audio.destroy()}}let c,l,d=[],u=!1;function p(t){!function(t){t.fillStyle="#000000",t.fillRect(0,0,flowerCanvas.width,flowerCanvas.height)}(t),d.forEach((t=>{t.visualizer.draw()}))}function w(){const t=document.getElementById("flowerCanvas"),e=window.innerHeight,a=window.innerWidth;t.setAttribute("width",a),t.setAttribute("height",e)}window.onload=function(){window.onclick=()=>{console.log("clicked"),u?(d.forEach((t=>{t.destroy()})),d=[new h(c,l)]):(function(){const t=window.AudioContext||window.webkitAudioContext;l=new t;const e=document.getElementById("flowerCanvas");if(!e)throw new Error("could not find flower Canvas");if(c=e.getContext("2d"),!e)throw new Error("could not get context");d.push(new h(c,l)),w(),window.onresize=function(t){w()};window.setInterval((()=>{d.forEach((t=>{t.beatUpdate()}))}),31.25),window.setInterval((()=>{}),16),window.setInterval((()=>{p(c)}),16),p(c)}(),u=!0)}}})();